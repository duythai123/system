package capstone_project.av_service.service.impl;

import javax.transaction.Transactional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import capstone_project.av_service.controller.error.BussinessException;
import capstone_project.av_service.model.Malware;
import capstone_project.av_service.model.MalwareRequestDto;
import capstone_project.av_service.repository.MalwareRepository;
import capstone_project.av_service.service.MalwareService;
import capstone_project.av_service.utils.ComplementUtil;

@Service
@Transactional
public class MalwareServiceImpl implements MalwareService {

	@Autowired
	MalwareRepository malwareRepository;
	
	@Override
	/**
	 * Create Malware into DB
	 */
	public Malware createMalware(MalwareRequestDto malwareRequestDto) throws Exception{
		Malware malware = getMalwareByImei(malwareRequestDto.getImei());
		if (malware != null) {
			throw new BussinessException("This malware is already exits");
		}
		malware = new Malware();
		ComplementUtil.complement(malwareRequestDto, malware);
		return malwareRepository.save(malware);
	}

	
	@Override
	/**
	 * Get malware by MD5
	 */
	public Malware getMalwareByImei(String imei) throws Exception {
		Malware malware = malwareRepository.findByImei(imei);
		return malware;
	}

	
	@Override
	/**
	 * Update Malware
	 */
	public Malware updateMalware(MalwareRequestDto malwareRequestDto) throws Exception {
		Malware malware = getMalwareByImei(malwareRequestDto.getImei());
		if (malware == null) {
			throw new BussinessException("Dont have this Malware");
		}
		
		ComplementUtil.complement(malwareRequestDto, malware);
		return malwareRepository.save(malware);
	}

}
